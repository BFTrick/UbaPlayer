(function(I){var G={audioButtonClass:"audioButton",autoPlay:null,codecs:[{name:"OGG",codec:'audio/ogg; codecs="vorbis"'},{name:"MP3",codec:"audio/mpeg"}],continuous:false,extension:null,flashAudioPlayerPath:"swf/player.swf",flashObjectID:"audioPlayer",loadingClass:"loading",loop:false,playerContainer:"player",playingClass:"playing",swfobjectPath:"js/swfobject.js",volume:0.5};var D;var H=false;var K=true;var J;var C;var M;var N;var L;var F;var B;var E={play:function(O){M=O;D=M.attr("href");H=true;M.addClass(G.loadingClass);C.removeClass(G.playingClass);if(K){if(J){A.removeListeners(window);}J=document.getElementById(G.flashObjectID);A.addListeners(window);J.playFlash(D+G.extension);}else{if(J){J.pause();A.removeListeners(J);}J=new Audio("");A.addListeners(J);J.id="audio";J.loop=G.loop?"loop":"";J.volume=G.volume;J.src=D+G.extension;J.play();}},pause:function(){if(K){J.pauseFlash();}else{J.pause();}M.removeClass(G.playingClass);H=false;},resume:function(){if(K){J.playFlash();}else{J.play();}M.addClass(G.playingClass);H=true;},playing:function(){return H;}};var A={init:function(O){I.extend(G,O);N=this;I(".controls").bind("click",function(T){A.updateTrackState(T);});C=I("."+G.audioButtonClass);var R=G.codecs;for(var Q=0,P=R.length;Q<P;Q++){var S=R[Q];if(A.canPlay(S)){G.extension=[".",S.name.toLowerCase()].join("");break;}}if(!G.extension||K){K=true;G.extension=".mp3";}if(K){N.html("<div id='"+G.playerContainer+"'/>");I.getScript(G.swfobjectPath,function(){swfobject.embedSWF(G.flashAudioPlayerPath,G.playerContainer,"0","0","9.0.0","swf/expressInstall.swf",false,false,{id:G.flashObjectID},A.swfLoaded);});}else{if(G.autoPlay){E.play(G.autoPlay);}}},updateTrackState:function(O){M=I(O.target);if(!M.hasClass("audioButton")){return ;}if(!J||(J&&D!==M.attr("href"))){E.play(M);}else{if(!H){E.resume();}else{E.pause();}}},addListeners:function(O){I(O).bind({canplay:A.onLoaded,error:A.onError,ended:A.onEnded});},removeListeners:function(O){I(O).unbind({canplay:A.onLoaded,error:A.onError,ended:A.onEnded});},onLoaded:function(){C.removeClass(G.loadingClass);M.addClass(G.playingClass);J.play();},onError:function(){C.removeClass(G.loadingClass);if(K){A.removeListeners(window);}else{A.removeListeners(J);}},onEnded:function(){H=false;M.removeClass(G.playingClass);D="";if(K){A.removeListeners(window);}else{A.removeListeners(J);}if(G.continuous){var O=M.next().length?M.next():I(G.audioButtonClass).eq(0);E.play(O);}},canPlay:function(O){if(!document.createElement("audio").canPlayType){return false;}else{return document.createElement("audio").canPlayType(O.codec).match(/maybe|probably/i)?true:false;}},swfLoaded:function(){if(G.autoPlay){setTimeout(function(){E.play(G.autoPlay);},500);}}};I.fn.ubaPlayer=function(O){if(E[O]){return E[O].apply(this,Array.prototype.slice.call(arguments,1));}else{if(typeof O==="object"||!O){return A.init.apply(this,arguments);}else{I.error("Method "+O+" does not exist on jquery.ubaPlayer");}}};})(jQuery);